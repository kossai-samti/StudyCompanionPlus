{% extends 'base.html.twig' %}

{% block title %}Neural Link | {{ user.firstName }}{% endblock %}

{% block stylesheets %}
<style>
    :root {
        --glass: rgba(15, 23, 42, 0.9);
        --neon-cyan: #00f3ff;
        --neon-purple: #bc13fe;
        --neon-red: #ff3131;
        --text-dim: #94a3b8;
        --bg-deep: #070b14;
        --nav-height: 80px;
    }

    body {
        background: radial-gradient(circle at center, #1e1b4b 0%, var(--bg-deep) 100%) !important;
        color: #f8fafc;
        font-family: 'Trebuchet MS', sans-serif;
        min-height: 100vh;
        margin: 0;
    }

    /* --- RGB POINT-TO-POINT ANIMATION --- */
    @keyframes rgb-flow {
        0% { border-image-source: linear-gradient(to right, var(--neon-cyan), var(--neon-purple)); }
        50% { border-image-source: linear-gradient(to bottom, var(--neon-purple), var(--neon-red)); }
        100% { border-image-source: linear-gradient(to right, var(--neon-cyan), var(--neon-purple)); }
    }

    /* --- RANDOM PROGRESS OSCILLATION --- */
    @keyframes progress-glitch {
        0% { width: 80%; }
        20% { width: 85%; }
        40% { width: 82%; }
        60% { width: 88%; }
        80% { width: 84%; }
        100% { width: 80%; }
    }

    /* --- DASHBOARD LISTS (PURPLE TO BLUE HOVER) --- */
    .list-container-cyber {
        border-left: 4px solid var(--neon-purple);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .list-container-cyber:hover {
        border-left-color: var(--neon-cyan);
        box-shadow: -10px 0 20px rgba(0, 243, 255, 0.2);
        background: rgba(0, 243, 255, 0.02);
    }

    /* --- PROGRESS SYNC BOX (PURPLE NEON BORDER) --- */
    .progress-sync-card {
        border-left: 4px solid var(--neon-purple);
        transition: 0.3s;
    }
    .progress-sync-card:hover {
        border-left-color: var(--neon-cyan);
        box-shadow: -5px 0 15px rgba(188, 19, 254, 0.3);
    }

    .animated-bar {
        height: 100%;
        background: var(--neon-cyan);
        box-shadow: 0 0 15px var(--neon-cyan);
        animation: progress-glitch 5s ease-in-out infinite;
    }

    /* --- BOTTOM MODULES (RGB + LIFT + GLOW) --- */
    .rgb-module {
        position: relative;
        border: 2px solid;
        border-image-slice: 1;
        border-image-source: linear-gradient(to right, var(--neon-cyan), var(--neon-purple));
        animation: rgb-flow 3s infinite;
        transition: all 0.4s ease;
        background: var(--glass);
        cursor: pointer;
    }
    .rgb-module:hover {
        transform: translateY(-15px);
        box-shadow: 0 0 30px rgba(0, 243, 255, 0.4), 0 0 60px rgba(188, 19, 254, 0.2);
    }

    /* --- EXISTING UI COMPONENTS --- */
    .fixed-nav {
        position: fixed; top: 0; left: 0; right: 0; height: var(--nav-height);
        background: rgba(7, 11, 20, 0.8); backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(0, 243, 255, 0.1);
        display: flex; align-items: center; justify-content: space-between;
        padding: 0 5%; z-index: 2000;
    }
    .nav-brand { font-weight: 900; color: #fff; text-decoration: none; text-transform: uppercase; letter-spacing: 2px; }
    .nav-brand span { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); }
    .nav-link-cyber { color: var(--text-dim); text-decoration: none; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; font-weight: bold; margin-left: 20px;}
    .nav-link-cyber:hover, .nav-link-cyber.active { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); }
    .btn-terminate { border: 1px solid var(--neon-red); color: var(--neon-red); padding: 8px 18px; border-radius: 4px; text-decoration: none; font-family: monospace; font-size: 11px; }
    .btn-terminate:hover { background: var(--neon-red); color: white; box-shadow: 0 0 20px var(--neon-red); }

    .container { max-width: 1200px; margin: 120px auto 50px; padding: 0 20px; display: grid; grid-template-columns: 1.8fr 1fr; gap: 30px; }
    .glass-card { background: var(--glass); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 20px; padding: 35px; }
    .hero-card { grid-column: span 2; border-left: 4px solid var(--neon-cyan); }

    .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 25px; }
    .stat-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); transition: 0.3s; }
    .stat-box:hover { border-color: var(--neon-cyan); transform: scale(1.05); }
    .stat-val { font-size: 1.8rem; font-weight: 900; color: var(--neon-cyan); display: block; }

    .neural-item { background: rgba(255,255,255,0.02); padding: 15px; border-radius: 10px; margin-bottom: 12px; display: flex; justify-content: space-between; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s;}
    .neural-item:hover { border-color: var(--neon-cyan); background: rgba(0,243,255,0.05); }

    .bottom-modules { grid-column: span 2; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 10px; }
</style>
{% endblock %}

{% block body %}
<nav class="fixed-nav">
    <a href="{{ path('student_dashboard') }}" class="nav-brand">STUDY<span>COMPANION+</span></a>
    <div>
        <a href="{{ path('student_dashboard') }}" class="nav-link-cyber active">Dashboard</a>
        <a href="{{ path('app_student_profile_list') }}" class="nav-link-cyber">Lessons</a>
        <a href="#" class="nav-link-cyber">Quizzes</a>
        <a href="#" class="nav-link-cyber">Performance</a>
    </div>
    <a href="{{ path('app_logout') }}" class="btn-terminate">TERMINATE SESSION</a>
</nav>

<div class="container">
    <div class="glass-card hero-card">
        <div style="display:flex; justify-content: space-between;">
            <div>
                <h1 style="margin:0; font-size: 3rem; font-weight: 900;">{{ user.firstName|upper }} {{ user.lastName|upper }}</h1>
                <span style="color: var(--neon-purple); font-family: monospace; font-size: 11px; letter-spacing: 2px;">PROTOCOL: STUDENT_DASHBOARD_V2.0</span>
            </div>
            <div style="text-align: right; font-family: monospace; font-size: 11px; color: var(--neon-cyan);">
                SYSTEM_READY <br> AI_LINK_STABLE
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 20px;">
            <div class="stat-box" style="text-align: center;">
                <span style="font-size:9px; color:var(--text-dim);">CORE_ID</span><br>
                <span style="font-family:monospace; color:var(--neon-cyan);">{{ core_id }}</span>
            </div>
            <div class="stat-box" style="text-align: center;">
                <span style="font-size:9px; color:var(--text-dim);">UPLINK_ADDR</span><br>
                <span style="font-family:monospace; color:var(--neon-cyan);">{{ user.email }}</span>
            </div>
            <div class="stat-box" style="text-align: center;">
                <span style="font-size:9px; color:var(--text-dim);">SYSTEM_ROLE</span><br>
                <span style="font-family:monospace; color:var(--neon-purple);">STUDENT</span>
            </div>
        </div>

        <div class="stat-grid">
            <div class="stat-box">
                <span style="font-size:10px; color:var(--text-dim);">Total Lessons</span>
                <span class="stat-val">{{ total_lessons_count }}</span>
            </div>
            <div class="stat-box">
                <span style="font-size:10px; color:var(--text-dim);">Total Quizzes</span>
                <span class="stat-val">9</span>
            </div>
            <div class="stat-box">
                <span style="font-size:10px; color:var(--text-dim);">Average Score</span>
                <span class="stat-val" style="color: var(--neon-purple);">{{ avg_score }}</span>
            </div>
            <div class="stat-box">
                <span style="font-size:10px; color:var(--text-dim);">Mastered</span>
                <span class="stat-val">{{ mastered_count }}</span>
            </div>
        </div>
    </div>

    <div class="glass-card list-container-cyber">
        <h3 style="font-size: 0.8rem; letter-spacing: 2px; color: var(--neon-cyan); margin-bottom: 20px;">AVAILABLE_QUIZZES</h3>
        {% for quiz in quizzes %}
            <div class="neural-item">
                <span>{{ quiz.title }}</span>
                <a href="#" style="color:var(--neon-purple); font-family: monospace; font-size: 11px; text-decoration:none;">[ INITIALIZE ]</a>
            </div>
        {% else %}
            <div class="neural-item" style="opacity: 0.6;">
                <span>No quizzes available.</span>
                <span style="font-family: monospace; font-size: 11px; color: var(--neon-red);">[ LOCKED ]</span>
            </div>
        {% endfor %}

        <h3 style="font-size: 0.8rem; letter-spacing: 2px; color: var(--neon-purple); margin-top: 30px; margin-bottom: 20px;">RECENT_LESSONS</h3>
        {% for lesson in lessons %}
            <div class="neural-item">
                <span>{{ lesson.title }}</span>
                <a href="#" style="color:var(--neon-cyan); font-family: monospace; font-size: 11px; text-decoration:none;">[ ACCESS ]</a>
            </div>
        {% else %}
            <div class="neural-item" style="opacity: 0.6;">
                <span>No active learning flows found.</span>
                <span style="font-family: monospace; font-size: 11px; color: var(--neon-red);">[ OFFLINE ]</span>
            </div>
        {% endfor %}
    </div>

    <div class="side-panel">
        <div class="glass-card" style="border-right: 4px solid var(--neon-purple); margin-bottom: 20px;">
            <h4 style="margin: 0; color: var(--neon-purple); font-size: 14px;">ðŸ§  CORTEX_ADVICE</h4>
            <p style="font-size: 12px; color: #cbd5e1; line-height: 1.6; margin-top: 15px;">Focus on <b>fractions</b> and <b>speed practice</b> for higher mastery.</p>
        </div>

        <div class="glass-card progress-sync-card">
            <h4 style="margin: 0; font-size: 14px; margin-bottom: 15px;">PROGRESS_SYNC</h4>
            <div style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin-bottom: 15px;">
                <div class="animated-bar"></div>
            </div>
            <ul style="padding: 0; list-style: none; font-size: 11px; color: var(--text-dim); line-height: 2;">
                <li>â€¢ Algebra quiz synced (+6%)</li>
                <li>â€¢ 12 flashcards reviewed (+3%)</li>
            </ul>
        </div>
    </div>

    <div class="bottom-modules">
        <div class="rgb-module" style="border-radius: 20px;">
            <div style="padding: 25px;">
                <span style="font-size: 24px;">âš¡</span>
                <h4 style="text-transform:uppercase; margin: 10px 0; font-size: 14px;">Learning Flows</h4>
                <p style="font-size: 11px; color: var(--text-dim); margin-bottom: 20px;">Access assigned educational pathways.</p>
                <a href="{{ path('app_student_profile_list') }}" style="color:var(--neon-cyan); font-family:monospace; text-decoration:none; font-weight:bold;">[ INITIALIZE ]</a>
            </div>
        </div>

        <div class="rgb-module" style="border-radius: 20px;">
            <div style="padding: 25px;">
                <span style="font-size: 24px;">ðŸ“¡</span>
                <h4 style="text-transform:uppercase; margin: 10px 0; font-size: 14px;">Cognitive Data</h4>
                <p style="font-size: 11px; color: var(--text-dim); margin-bottom: 20px;">Review performance metrics.</p>
                <a href="#" style="color:var(--neon-cyan); font-family:monospace; text-decoration:none; font-weight:bold;">[ PULL_DATA ]</a>
            </div>
        </div>

        <div class="rgb-module" style="border-radius: 20px;">
            <div style="padding: 25px;">
                <span style="font-size: 24px;">ðŸ§ </span>
                <h4 style="text-transform:uppercase; margin: 10px 0; font-size: 14px;">Neural Settings</h4>
                <p style="font-size: 11px; color: var(--text-dim); margin-bottom: 20px;">Calibrate user profile interface.</p>
                <a href="#" style="color:var(--neon-cyan); font-family:monospace; text-decoration:none; font-weight:bold;">[ CONFIGURE ]</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}