{% extends 'back/base.html.twig' %}
{% set panel = 'admin' %}

{% block title %}Admin | Lessons{% endblock %}

{% block content %}
  <section class="panel">
    <h1 style="margin:0 0 8px">Lessons</h1>
    <p style="margin:0;color:#bdd0ed">Track all lessons, who created them, and related group progress.</p>
  </section>

  <section class="panel" style="margin-top:12px">
    <table style="width:100%;border-collapse:collapse">
      <thead>
        <tr>
          <th style="text-align:left;padding:8px 4px;border-bottom:1px solid rgba(197,218,255,.25)">Title</th>
          <th style="text-align:left;padding:8px 4px;border-bottom:1px solid rgba(197,218,255,.25)">Subject</th>
          <th style="text-align:left;padding:8px 4px;border-bottom:1px solid rgba(197,218,255,.25)">Creator</th>
          <th style="text-align:left;padding:8px 4px;border-bottom:1px solid rgba(197,218,255,.25)">Group</th>
          <th style="text-align:left;padding:8px 4px;border-bottom:1px solid rgba(197,218,255,.25)">Students</th>
          <th style="text-align:left;padding:8px 4px;border-bottom:1px solid rgba(197,218,255,.25)">Progress</th>
          <th style="text-align:left;padding:8px 4px;border-bottom:1px solid rgba(197,218,255,.25)">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for row in lessonRows %}
          <tr>
            <td style="padding:10px 4px;border-bottom:1px solid rgba(197,218,255,.15)"><a href="{{ path('admin_lesson_show', {'id': row.id}) }}" style="color:#ffd86b;text-decoration:none">{{ row.title }}</a></td>
            <td style="padding:10px 4px;border-bottom:1px solid rgba(197,218,255,.15)">{{ row.subject }}</td>
            <td style="padding:10px 4px;border-bottom:1px solid rgba(197,218,255,.15)">{{ row.creatorName ?: '-' }} ({{ row.creatorRole ?: '-' }})</td>
            <td style="padding:10px 4px;border-bottom:1px solid rgba(197,218,255,.15)">{{ row.groupName ?: 'Individual student lesson' }}</td>
            <td style="padding:10px 4px;border-bottom:1px solid rgba(197,218,255,.15)">{{ row.groupStudents }}</td>
            <td style="padding:10px 4px;border-bottom:1px solid rgba(197,218,255,.15)">{{ row.avgProgress is not null ? row.avgProgress|number_format(1) ~ '%' : '-' }}</td>
            <td style="padding:10px 4px;border-bottom:1px solid rgba(197,218,255,.15)">
              <form method="post" action="{{ path('admin_lesson_delete', {'id': row.id}) }}" style="margin:0">
                <input type="hidden" name="_token" value="{{ csrf_token('admin_lesson_delete_' ~ row.id) }}">
                <button type="submit" class="action" style="margin:0;padding:6px 8px;border:none;cursor:pointer">Delete</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="7" style="padding:10px 4px;color:#bdd0ed">No lessons found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
{% endblock %}
